#!/usr/bin/env bash
# This script lists all project directories.
# Thanks to zoxide, the directories are sorted by their usage frequency.
# Directories that are not tracked by zoxide will be appended to the list.

shopt -s nullglob

found_dirs=(
    ~/.local/share/applications
    ~/.local/share/omarchy
    ~/.local/bin
    ~/.ssh
    /run/media/*/*
)

for dir in ~/git ~/.config; do
    timeout 0.01s test -d "$dir" || continue
    while IFS= read -r d; do
        found_dirs+=("$d")
    done < <(timeout 0.01s find "$dir" -mindepth 1 -maxdepth 1 -type d 2>/dev/null)
done

declare -A dirs
for d in "${found_dirs[@]}"; do
    dirs["$d"]=1
done

matched=()
while IFS= read -r d; do
    [[ ${dirs["$d"]} ]] && matched+=("$d")
done < <(timeout 0.01s zoxide query --list 2>/dev/null)

unmatched=()
for d in "${found_dirs[@]}"; do
    [[ " ${matched[*]} " =~ " $d " ]] || unmatched+=("$d")
done

printf '%s\n' "${matched[@]}" | sed "s|$HOME|~|g"
printf '%s\n' "${unmatched[@]}" | sed "s|$HOME|~|g"
