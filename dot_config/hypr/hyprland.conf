source=monitors.conf

# debug {
#     disable_logs = false
#     enable_stdout_logs = true
# }

###########
# Startup #
###########
exec-once = waybar

exec-once = dbus-update-activation-environment --systemd WAYLAND_DISPLAY XDG_CURRENT_DESKTOP
exec-once = gnome-keyring-daemon --start --components=secrets
exec-once = zellij delete-all-sessions --yes
exec-once = hypridle
exec-once = ~/.local/bin/background
exec-once = ~/.local/bin/startup
exec-once = ~/.local/bin/work-mode-daemon
exec-once = nm-applet --indicator
exec-once = systemctl --user import-environment
exec-once = udiskie
exec-once = /usr/lib/polkit-kde-authentication-agent-1
exec-once = vesktop --start-minimized --enable-features=UseOzonePlatform --ozone-platform=wayland
exec-once = wl-paste --type image --watch cliphist store
exec-once = wl-paste --type text  --watch cliphist store
exec-once = [workspace special:scratchpad silent] betterbird
exec-once = [workspace special:scratchpad silent] telegram-desktop
exec-once = xdg-desktop-portal-hyprland
exec-once = sleep 5 && stretchly --ozone-platform=wayland

#########
# Setup #
#########
input {
    kb_layout  = eu
    kb_options = caps:swapsuper
    sensitivity = -0.25
}

general {
    border_size         = 2
    col.active_border   = rgba(ff5e81ac) # DEEP PINK
    col.inactive_border = rgba(595959aa) # MEDIUM GREY
    $gap_size           = 4
    gaps_in             = $gap_size
    gaps_out            = $gap_size
    resize_on_border = true
    snap {
        enabled = true
    }
}

decoration {
    rounding    = 8
    shadow {
        enabled = false
    }
}

animations {
    bezier    = myBezier,   0.05, 0.9, 0.1, 1.05
    animation = border,     1, 2, default
    animation = fade,       1, 2, default
    animation = windows,    1, 2, myBezier
    animation = windowsOut, 1, 2, default, popin 80%
    animation = workspaces, 0, 2, default
}

dwindle {
    preserve_split       = true
    pseudotile           = true
    smart_split          = true
    special_scale_factor = 0.95
}

misc {
    key_press_enables_dpms  = true
    mouse_move_enables_dpms = true
    vrr                     = 1
}

#########
# Rules #
#########
windowrule = suppress_event maximize, match:class .*
windowrule = float on, match:class eu.betterbird.Betterbird, match:initial_title (Calendar Reminders|Edit)
windowrule = float on, match:class org.kde.polkit-kde-authentication-agent-1
windowrule = float on, match:class pavucontrol
windowrule = float on, match:class xdg-desktop-portal.*
windowrule = float on, match:class zenity
windowrule = float on, match:title Steam - Self Updater

windowrule = no_screen_share on, match:class eu.betterbird.Betterbird
windowrule = no_screen_share on, match:class org.telegram.desktop
windowrule = no_screen_share on, match:class Slack

##############
# Laptop Lid #
##############
bindl = , switch:on:Lid Switch,  exec, hyprctl keyword monitor desc:AU Optronics 0xD291, disable
bindl = , switch:off:Lid Switch, exec, hyprctl keyword monitor $(grep --only-matching "desc:AU Optronics 0xD291.*" "$XDG_CONFIG_HOME"/hypr/monitors.conf | grep -v disable)

#########
# Binds #
#########
$caps = SUPER

bind = CTRL,        SPACE,  exec, rofi -show combi -modi drun,http:rofi-http-status-codes,power:rofi-power-menu -combi-modi drun,http,monitor,power
bind = $caps SHIFT, SPACE,  exec, $XDG_CONFIG_HOME/hypr/rofi-rbw.sh
bind = $caps,       E,      exec, rofimoji --use-icons --action copy
bind = $caps,       RETURN, exec, $TERMINAL --working-directory="$(hyprcwd)"
bind = $caps SHIFT, RETURN, exec, project="$(ls-projects | rofi -dmenu)" && $TERMINAL -e zellij-sessionizer $project
bind = $caps SHIFT, G,      exec, $XDG_CONFIG_HOME/hypr/toggle-gaps.sh
bind = $caps SHIFT, S,      exec, sleep 1 && hyprctl dispatcher dpms off
bind = ,            Print,  exec, grimblast save area - | tee >(wl-copy) | swappy --file -
bind = SHIFT,       Print,  exec, grimblast --wait 2 save area - | tee >(wl-copy) | swappy --file -
bind = $caps,       B,      exec, killall waybar ; waybar
bind = $caps,       R,      exec, hyprctl reload
bind = $caps,       P,      exec, hyprctl --batch "dispatch togglefloating active; dispatch pin active",

bind = $caps,       O,      tagwindow, alpha
windowrule = opacity 0.6 override, match:tag alpha

bindel = , XF86AudioLowerVolume,  exec, pamixer -ud 3
bindel = , XF86AudioNext,         exec, playerctl next
bindel = , XF86AudioPlay,         exec, playerctl play-pause
bindel = , XF86AudioPrev,         exec, playerctl previous
bindel = , XF86AudioRaiseVolume,  exec, pamixer -ui 3
bindel = , XF86MonBrightnessDown, exec, brightnessctl s 5%-
bindel = , XF86MonBrightnessUp,   exec, brightnessctl s +5%
bindl  = , XF86AudioMute,         exec, amixer sset Master toggle

bindm = $caps, mouse:272, movewindow
bindm = $caps, mouse:273, resizewindow

bind = $caps, C,     centerwindow
bind = $caps, F,     fullscreen
bind = $caps, G,     togglegroup,
bind = $caps, Q,     killactive,
bind = $caps, SPACE, togglefloating,
bind = $caps, S,     swapsplit,      # dwindle
bind = $caps, T,     togglesplit,    # dwindle
bind = $caps, Y,     pseudo,         # dwindle

bind = $caps,       Tab, focuscurrentorlast

bind = $caps, H, movefocus, l
bind = $caps, J, movefocus, d
bind = $caps, K, movefocus, u
bind = $caps, L, movefocus, r

bind = $caps SHIFT, H, movewindow, l
bind = $caps SHIFT, J, movewindow, d
bind = $caps SHIFT, K, movewindow, u
bind = $caps SHIFT, L, movewindow, r

bind = $caps SHIFT CTRL, H, layoutmsg, preselect l
bind = $caps SHIFT CTRL, J, layoutmsg, preselect d
bind = $caps SHIFT CTRL, K, layoutmsg, preselect u
bind = $caps SHIFT CTRL, L, layoutmsg, preselect r

$resize = 30
binde=$caps CTRL, h, resizeactive, -$resize 0
binde=$caps CTRL, j, resizeactive, 0        $resize
binde=$caps CTRL, k, resizeactive, 0        -$resize
binde=$caps CTRL, l, resizeactive, $resize  0

bind = $caps, 1,      workspace, 1
bind = $caps, 2,      workspace, 2
bind = $caps, 3,      workspace, 3
bind = $caps, 4,      workspace, 4
bind = $caps, 5,      workspace, 5
bind = $caps, 6,      workspace, 6
bind = $caps, 7,      workspace, 7
bind = $caps, 8,      workspace, 8
bind = $caps, 9,      workspace, 9
bind = $caps, 0,      workspace, 10
bind = $caps, period, workspace, e+1
bind = $caps, comma,  workspace, e-1
bind = $caps, slash,  workspace, previous

bind = $caps SHIFT, 1, movetoworkspacesilent,  1
bind = $caps SHIFT, 2, movetoworkspacesilent,  2
bind = $caps SHIFT, 3, movetoworkspacesilent,  3
bind = $caps SHIFT, 4, movetoworkspacesilent,  4
bind = $caps SHIFT, 5, movetoworkspacesilent,  5
bind = $caps SHIFT, 6, movetoworkspacesilent,  6
bind = $caps SHIFT, 7, movetoworkspacesilent,  7
bind = $caps SHIFT, 8, movetoworkspacesilent,  8
bind = $caps SHIFT, 9, movetoworkspacesilent,  9
bind = $caps SHIFT, 0, movetoworkspacesilent,  10
bind = $caps SHIFT, equal, movetoworkspacesilent,  special:scratchpad
bind = $caps,       equal, togglespecialworkspace, scratchpad
workspace = special:scratchpad, on-created-empty:telegram-desktop -startintray; betterbird
bind = $caps SHIFT, C, movetoworkspacesilent,  special:chat
bind = $caps,       C, togglespecialworkspace, chat
workspace = special:chat, on-created-empty:gtk-launch WebApp-Chat.desktop

################
# Global Binds #
################
bindn = ,  mouse:276, sendshortcut, CTRL SHIFT, M, class:^(vesktop)$
bind  = ,      Pause, sendshortcut, CTRL SHIFT, M, class:^(vesktop)$
bind  = SHIFT, Pause, sendshortcut, CTRL SHIFT, D, class:^(vesktop)$
bind  = ,      Pause, sendshortcut, CTRL SHIFT, M, class:^(teams-for-linux)$
bind  = SHIFT, Pause, sendshortcut, CTRL SHIFT, O, class:^(teams-for-linux)$

# push to mute
bindn  = , mouse:276, exec, amixer sset Capture nocap
bindnr = , mouse:276, exec, amixer sset Capture cap
bindn  = , mouse:275, exec, amixer sset Capture nocap
bindnr = , mouse:275, exec, amixer sset Capture cap

###############
# Workarounds #
###############
# https://wiki.hyprland.org/Configuring/XWayland/#hidpi-xwayland
# change monitor to high resolution, the last argument is the scale factor
monitor = , highres, auto, 2
# unscale XWayland
xwayland {
  force_zero_scaling = true
}
# toolkit-specific scale
env = GDK_SCALE,2
env = XCURSOR_SIZE,32
envd = QT_CURSOR_SIZE,24

# https://wiki.hyprland.org/Useful-Utilities/Screen-Sharing/#xwayland
windowrule = opacity 0.0 override, no_anim on, no_initial_focus on, max_size 1 1, no_blur on, no_focus on, match:class ^(xwaylandvideobridge)$
